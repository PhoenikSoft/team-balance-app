databaseChangeLog:
  - preConditions:
      - runningAs:
          username: postgres

  - changeSet:
      id: add-user-group-tables-with-data
      author: Andriy Kuzmin
      changes:
        - sqlFile:
            path: changes/create_user_group_tables.sql
            relativeToChangelogFile: true
            stripComments: true
        - sqlFile:
            path: changes/insert_init_data.sql
            relativeToChangelogFile: true
            stripComments: true
  - changeSet:
      id: add-game-tables-with-data
      author: Yevhen Karychkovskyi
      changes:
        - sqlFile:
            path: changes/create_game_table.sql
            relativeToChangelogFile: true
            stripComments: true
        - sqlFile:
            path: changes/insert_game_data.sql
            relativeToChangelogFile: true
            stripComments: true
  - changeSet:
      id: add-group-ref-str-column
      author: Yevhen Karychkovskyi
      changes:
        - addColumn:
            columns:
              - column:
                  name: ref
                  type: char(20)
            schemaName: public
            tableName: tbl_group
  - changeSet:
      id: add-group-ref-unique-constraint
      author: Yevhen Karychkovskyi
      changes:
        - addUniqueConstraint:
            columnNames: ref
            constraintName: group-ref-unique
            schemaName: public
            tableName: tbl_group
            validate: true
  - changeSet:
      id: fill-group-ref-column
      author: Yevhen Karychkovskyi
      changes:
        - sqlFile:
            path: changes/insert_group_ref_data.sql
            relativeToChangelogFile: true
            stripComments: true
  - changeSet:
      id: add-balanced-teams-column-to-game
      author: Yevhen Karychkovskyi
      changes:
        - addColumn:
            columns:
              - column:
                  name: balanced_teams
                  type: jsonb
            schemaName: public
            tableName: tbl_game
  - changeSet:
      id: add-group-name-unique-constraint
      author: Yevhen Karychkovskyi
      changes:
        - addUniqueConstraint:
            columnNames: name
            constraintName: group-name-unique
            schemaName: public
            tableName: tbl_group
            validate: true
